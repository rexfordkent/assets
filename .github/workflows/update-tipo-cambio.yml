name: Actualizar Tipo de Cambio

on:
  schedule:
    - cron: '0 * * * *'  # Cada hora
  workflow_dispatch:     # Manual
  push:
    branches: [ main ]

jobs:
  update-rates:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.0'
    
    - name: Crear archivo JSON con valores por defecto
      run: |
        cat > tipo-cambio.json << 'EOF'
        {
          "sunat": {
            "compra": 3.730,
            "venta": 3.733,
            "fecha": "15/08/2025"
          },
          "sbs": {
            "compra": 3.730,
            "venta": 3.733,
            "fecha": "15/08/2025"
          },
          "ultima_actualizacion": "2025-08-15 16:00:00"
        }
        EOF
        
        echo "Archivo creado con valores por defecto"
        cat tipo-cambio.json
    
    - name: Commit y Push
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add tipo-cambio.json
        git diff --quiet && git diff --staged --quiet || git commit -m "Actualizar tipo de cambio - $(date +'%d/%m/%Y %H:%M')"
        git push
